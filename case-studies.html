<!-- Replace the entire tab content section with this -->
<div class="tab-content" id="caseStudyTabsContent">
  <!-- Ongoing Projects Tab -->
  <div class="tab-pane fade show active" id="ongoing" role="tabpanel" aria-labelledby="ongoing-tab">
    <div class="row g-4" id="ongoing-studies">
      <div class="col-12 text-center py-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-2">Loading case studies...</p>
      </div>
    </div>
  </div>
  
  <!-- Under Review Tab -->
  <div class="tab-pane fade" id="review" role="tabpanel" aria-labelledby="review-tab">
    <div class="row g-4" id="review-studies">
      <div class="col-12 text-center py-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-2">Loading case studies...</p>
      </div>
    </div>
  </div>
  
  <!-- Completed Tab -->
  <div class="tab-pane fade" id="completed" role="tabpanel" aria-labelledby="completed-tab">
    <div class="row g-4" id="completed-studies">
      <div class="col-12 text-center py-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-2">Loading case studies...</p>
      </div>
    </div>
  </div>
</div>

<!-- Add this script at the bottom of your case-studies.html, before closing body tag -->
<script>
// Your Google Sheets URL (CSV format)
const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQZEZswOKOUaXz2UzyJE2bKtavohwpqUbqaaXGa-YmDQAN79tgrA34d-MtxTT-JKNsVe28cJ1BQCfNY/pub?output=csv';

// Load case studies when page loads
document.addEventListener('DOMContentLoaded', function() {
  loadCaseStudies();
});

async function loadCaseStudies() {
  try {
    // Try to load from Google Sheets first
    const response = await fetch(SHEET_URL);
    const csvText = await response.text();
    const caseStudies = parseCSV(csvText);
    
    if (caseStudies.length > 0) {
      displayCaseStudies(caseStudies);
    } else {
      // Fallback to localStorage
      const localCaseStudies = JSON.parse(localStorage.getItem('vulaegisCaseStudies') || '[]');
      if (localCaseStudies.length > 0) {
        displayCaseStudies(localCaseStudies);
      } else {
        showNoStudiesMessage();
      }
    }
  } catch (error) {
    console.error('Error loading from Google Sheets:', error);
    // Fallback to localStorage
    const localCaseStudies = JSON.parse(localStorage.getItem('vulaegisCaseStudies') || '[]');
    if (localCaseStudies.length > 0) {
      displayCaseStudies(localCaseStudies);
    } else {
      showNoStudiesMessage();
    }
  }
}

function parseCSV(csvText) {
  const lines = csvText.split('\n');
  const caseStudies = [];
  
  // Skip header row and start from index 1
  for (let i = 1; i < lines.length; i++) {
    const line = lines[i].trim();
    if (!line) continue;
    
    // Simple CSV parsing
    const columns = line.split(',').map(col => col.trim().replace(/^"|"$/g, ''));
    
    if (columns.length >= 5) {
      caseStudies.push({
        id: columns[0] || i,
        title: columns[1],
        abstract: columns[2],
        status: columns[3],
        driveLink: columns[4]
      });
    }
  }
  
  return caseStudies;
}

function displayCaseStudies(caseStudies) {
  // Clear existing content
  document.getElementById('ongoing-studies').innerHTML = '';
  document.getElementById('review-studies').innerHTML = '';
  document.getElementById('completed-studies').innerHTML = '';
  
  if (caseStudies.length === 0) {
    showNoStudiesMessage();
    return;
  }
  
  // Sort case studies by status
  caseStudies.forEach(caseStudy => {
    const cardHTML = `
      <div class="col-md-6 col-lg-4">
        <div class="card h-100 border-0 shadow">
          <div class="card-body">
            ${getStatusBadge(caseStudy.status)}
            <h5 class="card-title">${caseStudy.title}</h5>
            <p class="card-text">${caseStudy.abstract}</p>
            <a href="${caseStudy.driveLink}" class="btn btn-primary btn-sm" target="_blank">View Full Report</a>
          </div>
        </div>
      </div>
    `;
    
    // Add to appropriate section based on status
    switch(caseStudy.status) {
      case 'ongoing':
        document.getElementById('ongoing-studies').innerHTML += cardHTML;
        break;
      case 'review':
        document.getElementById('review-studies').innerHTML += cardHTML;
        break;
      case 'completed':
        document.getElementById('completed-studies').innerHTML += cardHTML;
        break;
    }
  });
}

function getStatusBadge(status) {
  const badges = {
    'ongoing': '<span class="badge bg-warning text-dark status-badge mb-2">Ongoing</span>',
    'review': '<span class="badge bg-info status-badge mb-2">Under Review</span>',
    'completed': '<span class="badge bg-success status-badge mb-2">Completed</span>'
  };
  return badges[status] || '';
}

function showNoStudiesMessage() {
  const message = `
    <div class="col-12 text-center py-5">
      <h4>No case studies yet</h4>
      <p class="text-muted">Add your first case study using the admin panel</p>
      <a href="admin-case-studies.html" class="btn btn-primary">Go to Admin Panel</a>
    </div>
  `;
  
  document.getElementById('ongoing-studies').innerHTML = message;
}
</script>
